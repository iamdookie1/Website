<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audio Trimmer</title>
<style>
:root {
    --bg: radial-gradient(circle at top, #1a1a1a, #000000);
    --gold: #d4af37;
    --gold-soft: rgba(212,175,55,0.15);
    --panel: rgba(20,20,20,0.9);
    --text: #f5f5f5;
    --muted: #999;
}
* {
    box-sizing: border-box;
}
body {
    margin: 0;
    min-height: 100vh;
    background: var(--bg);
    color: var(--text);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
}
.container {
    width: 100%;
    max-width: 700px;
    padding: 40px;
}
.panel {
    background: var(--panel);
    border: 1px solid var(--gold-soft);
    border-radius: 16px;
    padding: 32px;
    box-shadow: 0 0 60px rgba(212,175,55,0.08);
}
.panel + .panel {
    margin-top: 24px;
}
h1 {
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 24px;
    color: var(--gold);
    text-align: center;
}
.import-box {
    border: 2px dashed var(--gold-soft);
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.2s;
}
.import-box:hover {
    border-color: var(--gold);
}
.import-box input {
    display: none;
}
.import-box span {
    font-size: 18px;
    color: var(--muted);
}
.controls {
    display: none;
}
.control-row {
    margin-bottom: 20px;
}
label {
    display: block;
    font-size: 14px;
    margin-bottom: 6px;
    color: var(--muted);
}
input[type="range"] {
    width: 100%;
}
.buttons {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}
button {
    flex: 1;
    background: linear-gradient(135deg, #b8962e, #f0d57a);
    border: none;
    color: #000;
    font-weight: 600;
    padding: 14px;
    border-radius: 10px;
    cursor: pointer;
}
button.secondary {
    background: transparent;
    color: var(--gold);
    border: 1px solid var(--gold-soft);
}
button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.toggle {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
}
.toggle input {
    width: 18px;
    height: 18px;
}
.time {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    color: var(--muted);
}
</style>
</head>
<body>
<div class="container">
    <div class="panel">
        <h1>Import File</h1>
        <label class="import-box">
            <input type="file" id="fileInput" accept="audio/*">
            <span>Click to import an audio file</span>
        </label>
    </div>

    <div class="panel controls" id="editor">
        <h1>Trim Audio</h1>

        <div class="toggle">
            <input type="checkbox" id="previewToggle">
            <label for="previewToggle">Preview trimmed section only</label>
        </div>

        <div class="control-row">
            <label>Start</label>
            <input type="range" id="startRange" min="0" step="0.01">
        </div>

        <div class="control-row">
            <label>End</label>
            <input type="range" id="endRange" min="0" step="0.01">
        </div>

        <div class="time">
            <span id="startTime">0.00s</span>
            <span id="endTime">0.00s</span>
        </div>

        <div class="buttons">
            <button id="playBtn">Play</button>
            <button class="secondary" id="downloadBtn">Download</button>
        </div>
    </div>
</div>

<script>
let audioBuffer;
let audioContext;
let source;
let duration = 0;

const fileInput = document.getElementById("fileInput");
const editor = document.getElementById("editor");
const startRange = document.getElementById("startRange");
const endRange = document.getElementById("endRange");
const startTime = document.getElementById("startTime");
const endTime = document.getElementById("endTime");
const playBtn = document.getElementById("playBtn");
const downloadBtn = document.getElementById("downloadBtn");
const previewToggle = document.getElementById("previewToggle");

fileInput.onchange = async e => {
    const file = e.target.files[0];
    if (!file) return;

    audioContext = new AudioContext();
    const arrayBuffer = await file.arrayBuffer();
    audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
    duration = audioBuffer.duration;

    startRange.max = duration;
    endRange.max = duration;
    endRange.value = duration;

    updateTimes();
    editor.style.display = "block";
};

function updateTimes() {
    startTime.textContent = Number(startRange.value).toFixed(2) + "s";
    endTime.textContent = Number(endRange.value).toFixed(2) + "s";
}

startRange.oninput = () => {
    if (Number(startRange.value) >= Number(endRange.value)) {
        startRange.value = endRange.value - 0.01;
    }
    updateTimes();
};

endRange.oninput = () => {
    if (Number(endRange.value) <= Number(startRange.value)) {
        endRange.value = Number(startRange.value) + 0.01;
    }
    updateTimes();
};

playBtn.onclick = () => {
    if (!audioBuffer) return;
    if (source) source.stop();

    source = audioContext.createBufferSource();
    source.buffer = audioBuffer;
    source.connect(audioContext.destination);

    const start = Number(startRange.value);
    const end = Number(endRange.value);

    if (previewToggle.checked) {
        source.start(0, start, end - start);
    } else {
        source.start(0);
    }
};

downloadBtn.onclick = async () => {
    const start = Number(startRange.value);
    const end = Number(endRange.value);
    const length = (end - start) * audioBuffer.sampleRate;

    const offline = new OfflineAudioContext(
        audioBuffer.numberOfChannels,
        length,
        audioBuffer.sampleRate
    );

    const trimmed = offline.createBufferSource();
    trimmed.buffer = audioBuffer;
    trimmed.connect(offline.destination);
    trimmed.start(0, start, end - start);

    const rendered = await offline.startRendering();
    const wav = encodeWAV(rendered);
    const blob = new Blob([wav], { type: "audio/wav" });

    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "trimmed_audio.wav";
    a.click();
};

function encodeWAV(buffer) {
    const channels = buffer.numberOfChannels;
    const length = buffer.length * channels * 2 + 44;
    const view = new DataView(new ArrayBuffer(length));
    let offset = 0;

    const write = s => { for (let i = 0; i < s.length; i++) view.setUint8(offset++, s.charCodeAt(i)); };
    const write16 = d => { view.setUint16(offset, d, true); offset += 2; };
    const write32 = d => { view.setUint32(offset, d, true); offset += 4; };

    write("RIFF"); write32(length - 8); write("WAVE");
    write("fmt "); write32(16); write16(1);
    write16(channels); write32(buffer.sampleRate);
    write32(buffer.sampleRate * channels * 2);
    write16(channels * 2); write16(16);
    write("data"); write32(length - offset - 4);

    for (let i = 0; i < buffer.length; i++) {
        for (let c = 0; c < channels; c++) {
            let sample = buffer.getChannelData(c)[i];
            sample = Math.max(-1, Math.min(1, sample));
            view.setInt16(offset, sample * 32767, true);
            offset += 2;
        }
    }
    return view.buffer;
}
</script>
</body>
</html>
